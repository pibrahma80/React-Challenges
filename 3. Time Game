import "./styles.css";
import { useState, useEffect } from "react";

export default function App() {
  const [gameRunning, setGameRunning] = useState(false);
  const [time, setTime] = useState(3);
  const [clicks, setClicks] = useState(0);

  // useEffect(() => {
  //   let interval;
  //   if (gameRunning && time > 0) {
  //     interval = setInterval(() => {
  //       setTime((prev) => prev - 1);
  //     }, 1000);
  //   }
  //   if (time === 0) {
  //     setGameRunning(false);
  //     clearInterval(interval)
  //     alert("Game has ended");
  //   }

  //   return () => clearInterval(interval);
  // }, [gameRunning, time]);

  useEffect(() => {
    let interval;
    if (gameRunning && time > 0) {
      interval = setInterval(() => {
        setTime((prev) => prev - 1);
      }, 1000);
    }
    if (time === 0) {
      setGameRunning(false);
      clearInterval(interval); // Clear the interval immediately when time reaches 0
      setTimeout(() => {
        alert("Game has ended");
      }, 100); // Add a small delay before displaying the alert
    }
  
    return () => clearInterval(interval);
  }, [gameRunning, time]);
  

  const handleGame = () => {
    setGameRunning(true);
    setTime(3);
    setClicks(0); // Reset clicks when starting a new game
  };

  const handleClicks = () => {
    if (!gameRunning) {
      alert("Please start the game");
    }
    if (gameRunning) {
      setClicks((prev) => prev + 1);
    }
  };

  return (
    <div className="App">
      <h1>Time Remaining - {time}</h1>
      <h2>No of Clicks - {clicks}</h2>
      <button
        onClick={handleGame}
        disabled={gameRunning}
        style={{ marginRight: "15px" }}
      >
        START
      </button>
      <button onClick={handleClicks} disabled={!gameRunning}>
        +
      </button>
    </div>
  );
}
